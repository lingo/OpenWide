#include	<windows.h>

extern void dbg(char *szError, ...);




#define DEFINE_MSG(x)	{ x, #x },

typedef struct MsgDef
{
	UINT msg;
	const char *text;
} MsgDef, *PMsgDef;


#define START_MSGDEF	static MsgDef WMsgDefs[]  = {
#define END_MSGDEF	{-1, NULL} }; static int NMsgDefs = sizeof(WMsgDefs)/sizeof(MsgDef);



START_MSGDEF

	DEFINE_MSG( WM_NULL )
	DEFINE_MSG( WM_APP	 )
	DEFINE_MSG( WM_ACTIVATE )
	DEFINE_MSG( WM_ACTIVATEAPP )
	DEFINE_MSG( WM_ASKCBFORMATNAME )
	DEFINE_MSG( WM_CANCELJOURNAL )
	DEFINE_MSG( WM_CANCELMODE )
	DEFINE_MSG( WM_CAPTURECHANGED )
	DEFINE_MSG( WM_CHANGECBCHAIN )
	DEFINE_MSG( WM_CHAR )
	DEFINE_MSG( WM_CHARTOITEM )
	DEFINE_MSG( WM_CHILDACTIVATE )
	DEFINE_MSG( WM_CHOOSEFONT_GETLOGFONT )
	DEFINE_MSG( WM_CHOOSEFONT_SETLOGFONT )
	DEFINE_MSG( WM_CHOOSEFONT_SETFLAGS )
	DEFINE_MSG( WM_CLEAR )
	DEFINE_MSG( WM_CLOSE )
	DEFINE_MSG( WM_COMMAND )
	DEFINE_MSG( WM_COMPACTING )
	DEFINE_MSG( WM_COMPAREITEM )
	DEFINE_MSG( WM_CONTEXTMENU )
	DEFINE_MSG( WM_COPY )
	DEFINE_MSG( WM_COPYDATA )
	DEFINE_MSG( WM_CREATE )
	DEFINE_MSG( WM_CTLCOLORBTN )
	DEFINE_MSG( WM_CTLCOLORDLG )
	DEFINE_MSG( WM_CTLCOLOREDIT )
	DEFINE_MSG( WM_CTLCOLORLISTBOX )
	DEFINE_MSG( WM_CTLCOLORMSGBOX )
	DEFINE_MSG( WM_CTLCOLORSCROLLBAR )
	DEFINE_MSG( WM_CTLCOLORSTATIC )
	DEFINE_MSG( WM_CUT )
	DEFINE_MSG( WM_DEADCHAR )
	DEFINE_MSG( WM_DELETEITEM )
	DEFINE_MSG( WM_DESTROY )
	DEFINE_MSG( WM_DESTROYCLIPBOARD )
	DEFINE_MSG( WM_DEVICECHANGE )
	DEFINE_MSG( WM_DEVMODECHANGE )
	DEFINE_MSG( WM_DISPLAYCHANGE )
	DEFINE_MSG( WM_DRAWCLIPBOARD )
	DEFINE_MSG( WM_DRAWITEM )
	DEFINE_MSG( WM_DROPFILES )
	DEFINE_MSG( WM_ENABLE )
	DEFINE_MSG( WM_ENDSESSION )
	DEFINE_MSG( WM_ENTERIDLE )
	DEFINE_MSG( WM_ENTERMENULOOP )
	DEFINE_MSG( WM_ENTERSIZEMOVE )
	DEFINE_MSG( WM_ERASEBKGND )
	DEFINE_MSG( WM_EXITMENULOOP )
	DEFINE_MSG( WM_EXITSIZEMOVE )
	DEFINE_MSG( WM_FONTCHANGE )
	DEFINE_MSG( WM_GETDLGCODE )
	DEFINE_MSG( WM_GETFONT )
	DEFINE_MSG( WM_GETHOTKEY )
	DEFINE_MSG( WM_GETICON )
	DEFINE_MSG( WM_GETMINMAXINFO )
	DEFINE_MSG( WM_GETTEXT )
	DEFINE_MSG( WM_GETTEXTLENGTH )
	DEFINE_MSG( WM_HELP )
	DEFINE_MSG( WM_HOTKEY )
	DEFINE_MSG( WM_HSCROLL )
	DEFINE_MSG( WM_HSCROLLCLIPBOARD )
	DEFINE_MSG( WM_ICONERASEBKGND )
	DEFINE_MSG( WM_IME_CHAR )
	DEFINE_MSG( WM_IME_COMPOSITION )
	DEFINE_MSG( WM_IME_COMPOSITIONFULL )
	DEFINE_MSG( WM_IME_CONTROL )
	DEFINE_MSG( WM_IME_ENDCOMPOSITION )
	DEFINE_MSG( WM_IME_KEYDOWN )
	DEFINE_MSG( WM_IME_KEYUP )
	DEFINE_MSG( WM_IME_NOTIFY )
	DEFINE_MSG( WM_IME_SELECT )
	DEFINE_MSG( WM_IME_SETCONTEXT )
	DEFINE_MSG( WM_IME_STARTCOMPOSITION )
	DEFINE_MSG( WM_INITDIALOG )
	DEFINE_MSG( WM_INITMENU )
	DEFINE_MSG( WM_INITMENUPOPUP )
	DEFINE_MSG( WM_INPUTLANGCHANGE )
	DEFINE_MSG( WM_INPUTLANGCHANGEREQUEST )
	DEFINE_MSG( WM_INPUT )
	DEFINE_MSG( WM_KEYDOWN )
	DEFINE_MSG( WM_KEYUP )
	DEFINE_MSG( WM_KILLFOCUS )
	DEFINE_MSG( WM_LBUTTONDBLCLK )
	DEFINE_MSG( WM_LBUTTONDOWN )
	DEFINE_MSG( WM_LBUTTONUP )
	DEFINE_MSG( WM_MBUTTONDBLCLK )
	DEFINE_MSG( WM_MBUTTONDOWN )
	DEFINE_MSG( WM_MBUTTONUP )
	DEFINE_MSG( WM_MDIACTIVATE )
	DEFINE_MSG( WM_MDICASCADE )
	DEFINE_MSG( WM_MDICREATE )
	DEFINE_MSG( WM_MDIDESTROY )
	DEFINE_MSG( WM_MDIGETACTIVE )
	DEFINE_MSG( WM_MDIICONARRANGE )
	DEFINE_MSG( WM_MDIMAXIMIZE )
	DEFINE_MSG( WM_MDINEXT )
	DEFINE_MSG( WM_MDIREFRESHMENU )
	DEFINE_MSG( WM_MDIRESTORE )
	DEFINE_MSG( WM_MDISETMENU )
	DEFINE_MSG( WM_MDITILE )
	DEFINE_MSG( WM_MEASUREITEM )
	DEFINE_MSG( WM_MENUCHAR )
	DEFINE_MSG( WM_MENUSELECT )
	DEFINE_MSG( WM_MENURBUTTONUP )
	DEFINE_MSG( WM_MENUDRAG )
	DEFINE_MSG( WM_MENUGETOBJECT )
	DEFINE_MSG( WM_UNINITMENUPOPUP )
	DEFINE_MSG( WM_MENUCOMMAND )
	DEFINE_MSG( WM_CHANGEUISTATE )
	DEFINE_MSG( WM_UPDATEUISTATE )
	DEFINE_MSG( WM_QUERYUISTATE )
	DEFINE_MSG( WM_MOUSEACTIVATE )
	DEFINE_MSG( WM_MOUSEMOVE )
	DEFINE_MSG( WM_MOUSEHOVER )
	DEFINE_MSG( WM_MOUSELEAVE )
	DEFINE_MSG( WM_MOUSEWHEEL )
	DEFINE_MSG( WM_MOVE )
	DEFINE_MSG( WM_MOVING )
	DEFINE_MSG( WM_NCACTIVATE )
	DEFINE_MSG( WM_NCCALCSIZE )
	DEFINE_MSG( WM_NCCREATE )
	DEFINE_MSG( WM_NCDESTROY )
	DEFINE_MSG( WM_NCHITTEST )
	DEFINE_MSG( WM_NCLBUTTONDBLCLK )
	DEFINE_MSG( WM_NCLBUTTONDOWN )
	DEFINE_MSG( WM_NCLBUTTONUP )
	DEFINE_MSG( WM_NCMBUTTONDBLCLK )
	DEFINE_MSG( WM_NCMBUTTONDOWN )
	DEFINE_MSG( WM_NCMBUTTONUP )
	DEFINE_MSG( WM_NCMOUSEMOVE )
	DEFINE_MSG( WM_NCPAINT )
	DEFINE_MSG( WM_NCRBUTTONDBLCLK )
	DEFINE_MSG( WM_NCRBUTTONDOWN )
	DEFINE_MSG( WM_NCRBUTTONUP )
	DEFINE_MSG( WM_NEXTDLGCTL )
	DEFINE_MSG( WM_NOTIFY )
	DEFINE_MSG( WM_NOTIFYFORMAT )
	DEFINE_MSG( WM_PAINT )
	DEFINE_MSG( WM_PAINTCLIPBOARD )
	DEFINE_MSG( WM_PAINTICON )
	DEFINE_MSG( WM_PALETTECHANGED )
	DEFINE_MSG( WM_PALETTEISCHANGING )
	DEFINE_MSG( WM_PARENTNOTIFY )
	DEFINE_MSG( WM_PASTE )
	DEFINE_MSG( WM_PENWIFIRST )
	DEFINE_MSG( WM_AFXFIRST )
	DEFINE_MSG( WM_AFXLAST )
	DEFINE_MSG( WM_HANDHELDFIRST )
	DEFINE_MSG( WM_HANDHELDLAST )
	DEFINE_MSG( WM_PENWINLAST )
	DEFINE_MSG( WM_POWER )
	DEFINE_MSG( WM_POWERBROADCAST )
	DEFINE_MSG( WM_PRINT )
	DEFINE_MSG( WM_PRINTCLIENT )
	DEFINE_MSG( WM_PSD_ENVSTAMPRECT )
	DEFINE_MSG( WM_PSD_FULLPAGERECT )
	DEFINE_MSG( WM_PSD_GREEKTEXTRECT )
	DEFINE_MSG( WM_PSD_MARGINRECT )
	DEFINE_MSG( WM_PSD_MINMARGINRECT )
	DEFINE_MSG( WM_PSD_PAGESETUPDLG )
	DEFINE_MSG( WM_PSD_YAFULLPAGERECT )
	DEFINE_MSG( WM_QUERYDRAGICON )
	DEFINE_MSG( WM_QUERYENDSESSION )
	DEFINE_MSG( WM_QUERYNEWPALETTE )
	DEFINE_MSG( WM_QUERYOPEN )
	DEFINE_MSG( WM_QUEUESYNC )
	DEFINE_MSG( WM_QUIT )
	DEFINE_MSG( WM_RBUTTONDBLCLK )
	DEFINE_MSG( WM_RBUTTONDOWN )
	DEFINE_MSG( WM_RBUTTONUP )
	DEFINE_MSG( WM_RENDERALLFORMATS )
	DEFINE_MSG( WM_RENDERFORMAT )
	DEFINE_MSG( WM_SETCURSOR )
	DEFINE_MSG( WM_SETFOCUS )
	DEFINE_MSG( WM_SETFONT )
	DEFINE_MSG( WM_SETHOTKEY )
	DEFINE_MSG( WM_SETICON )
	DEFINE_MSG( WM_SETREDRAW )
	DEFINE_MSG( WM_SETTEXT )
	DEFINE_MSG( WM_SETTINGCHANGE )
	DEFINE_MSG( WM_SHOWWINDOW )
	DEFINE_MSG( WM_SIZE )
	DEFINE_MSG( WM_SIZECLIPBOARD )
	DEFINE_MSG( WM_SIZING )
	DEFINE_MSG( WM_SPOOLERSTATUS )
	DEFINE_MSG( WM_STYLECHANGED )
	DEFINE_MSG( WM_STYLECHANGING )
	DEFINE_MSG( WM_SYSCHAR )
	DEFINE_MSG( WM_SYSCOLORCHANGE )
	DEFINE_MSG( WM_SYSCOMMAND )
	DEFINE_MSG( WM_SYSDEADCHAR )
	DEFINE_MSG( WM_SYSKEYDOWN )
	DEFINE_MSG( WM_SYSKEYUP )
	DEFINE_MSG( WM_TCARD )
	DEFINE_MSG( WM_TIMECHANGE )
	DEFINE_MSG( WM_TIMER )
	DEFINE_MSG( WM_UNDO )
	DEFINE_MSG( WM_USER )
	DEFINE_MSG( WM_USERCHANGED )
	DEFINE_MSG( WM_VKEYTOITEM )
	DEFINE_MSG( WM_VSCROLL )
	DEFINE_MSG( WM_VSCROLLCLIPBOARD )
	DEFINE_MSG( WM_WINDOWPOSCHANGED )
	DEFINE_MSG( WM_WINDOWPOSCHANGING )
	DEFINE_MSG( WM_XBUTTONDOWN )
	DEFINE_MSG( WM_XBUTTONUP )
	DEFINE_MSG( WM_XBUTTONDBLCLK )
	DEFINE_MSG( WM_WININICHANGE )
	DEFINE_MSG( WM_KEYFIRST )
	DEFINE_MSG( WM_KEYLAST )
	DEFINE_MSG( WM_MOUSEFIRST )
#if (_WIN32_WINNT >= 0x0500)
	DEFINE_MSG( WM_MOUSELAST )
#elif (_WIN32_WINNT >= 0x0400) || (_WIN32_WINDOWS > 0x0400)
	DEFINE_MSG( WM_MOUSELAST )
#else
	DEFINE_MSG( WM_MOUSELAST )
#endif
	DEFINE_MSG( WM_NEXTMENU )
	DEFINE_MSG( WM_CHANGEUISTATE )
	DEFINE_MSG( WM_UPDATEUISTATE )
	DEFINE_MSG( WM_QUERYUISTATE )
	DEFINE_MSG( WM_WTSSESSION_CHANGE )
	DEFINE_MSG( WM_LBTRACKPOINT )
	DEFINE_MSG( WM_GETOBJECT )
	DEFINE_MSG( WM_COMMNOTIFY )
	DEFINE_MSG( WM_TABLET_FIRST )
	DEFINE_MSG( WM_TABLET_LAST )

END_MSGDEF

int compMsgDefs(const struct MsgDef *pa, const struct MsgDef *pb)
{
	return pa->msg - pb->msg;
}

MsgDef * bSearch(UINT uFind, struct MsgDef array[], int iStart, int iEnd)
{
	if( iStart == iEnd )
		return (array[iStart].msg == uFind ? &array[iStart] : NULL );

	int iMid = (iStart + iEnd)/2;

	if( array[iMid].msg == uFind )
		return &array[iMid];
	else if( uFind > array[iMid].msg )
		return bSearch(uFind, array, iMid+1, iEnd);
	else
		return bSearch(uFind, array, iStart, iMid);
}

MsgDef * findMsg(UINT msg)
{
	return bSearch(msg, WMsgDefs,0, NMsgDefs-1);
}

void dbgWM(HWND hwnd, UINT msg, WPARAM wp, LPARAM lp)
{
	static int isSorted = 0;
	if(!isSorted)
	{
		qsort(WMsgDefs, NMsgDefs, sizeof(struct MsgDef), compMsgDefs);
		isSorted = 1;
	}
	struct MsgDef *pMsg = findMsg(msg);
	if(pMsg)
		dbg("%s: hwnd(%p) msg(%u) wp(%x) lp(%lx)",
			pMsg->text, hwnd, msg, wp, lp);
}
